# Plan de Mejora Integral ‚Äî Markdown Pedag√≥gico

## Diagn√≥stico del Estado Actual

El software hoy es un **editor de Markdown pedag√≥gico** funcional (React + Tauri v1) con:

| √Årea | Estado | Hallazgo clave |
|------|--------|----------------|
| Arquitectura | ‚ö†Ô∏è Deuda | `Editor.tsx` monol√≠tico (561 l√≠neas) concentra l√≥gica de UI, estado, exportaci√≥n PDF y referencia |
| Motor pedag√≥gico | üü° B√°sico | 4 reglas (afirmaciones absolutas, clich√©s ret√≥ricos, jerarqu√≠a de encabezados, muros de texto) + onboarding simple |
| UX de escritura | üî¥ Limitado | Sin atajos de teclado, sin abrir archivos, sin numeraci√≥n de l√≠neas, sin syntax highlighting |
| Exportaci√≥n | üü¢ Funcional | PDF v√≠a html2canvas (con workaround oklch), `.md` v√≠a Rust |
| Testing | üî¥ Inexistente | 0 archivos de test |
| Accesibilidad | üî¥ Sin implementar | Sin ARIA roles, sin navegaci√≥n por teclado para tooltips |
| Limpieza | ‚ö†Ô∏è Menor | `App.css` contiene boilerplate de Vite sin usar |

---

## Fases de Mejora

Las fases est√°n ordenadas por **impacto pedag√≥gico + estabilidad**. Cada fase es independiente e incrementalmente desplegable.

---

### Fase 1 ¬∑ Refactorizaci√≥n Arquitect√≥nica y Limpieza

> **Objetivo**: Hacer el c√≥digo mantenible y prepararlo para nuevas funciones sin cambiar comportamiento visible.

#### [DELETE] [App.css](file:///Users/nestor/Documents/Desarrollo/Markdown%20editor/src/App.css)

- Eliminar boilerplate de Vite (`.logo`, `.card`, `.read-the-docs`) que no se usa.

#### [MODIFY] [App.tsx](file:///Users/nestor/Documents/Desarrollo/Markdown%20editor/src/App.tsx)

- Eliminar `import './App.css'` (no existe en el archivo actual, pero confirmar).

#### [MODIFY] [index.html](file:///Users/nestor/Documents/Desarrollo/Markdown%20editor/index.html)

- Cambiar `<title>` de "vite-app" a "Markdown Pedag√≥gico".
- A√±adir `lang="es"` al `<html>`.
- A√±adir `<meta name="description">`.

#### [MODIFY] [Editor.tsx](file:///Users/nestor/Documents/Desarrollo/Markdown%20editor/src/components/Editor/Editor.tsx)

- **Extraer** la l√≥gica de exportaci√≥n PDF a un nuevo hook `useExportPdf.ts`.
- **Extraer** la l√≥gica de guardado/apertura de archivos a un hook `useFileOperations.ts`.
- **Extraer** el estado del tooltip a un hook `useTooltipState.ts`.
- **Extraer** el panel de referencia a un componente `ReferencePanel.tsx`.
- **Extraer** la barra de herramientas (header) a un componente `Toolbar.tsx`.
- El `Editor.tsx` resultante deber√≠a tener ~120 l√≠neas m√°ximo, orquestando los hooks y componentes.

#### [NEW] `src/hooks/useExportPdf.ts`

#### [NEW] `src/hooks/useFileOperations.ts`  

#### [NEW] `src/hooks/useTooltipState.ts`

#### [NEW] `src/components/Editor/Toolbar.tsx`

#### [NEW] `src/components/Editor/ReferencePanel.tsx`

---

### Fase 2 ¬∑ UX de Escritura Profesional

> **Objetivo**: Acercar la experiencia de escritura a editores de referencia (Typora, Obsidian, StackEdit).

#### [MODIFY] [Editor.tsx](file:///Users/nestor/Documents/Desarrollo/Markdown%20editor/src/components/Editor/Editor.tsx)

- **Atajos de teclado**: `Cmd/Ctrl+B` (bold), `Cmd/Ctrl+I` (italic), `Cmd/Ctrl+S` (guardar), `Cmd/Ctrl+Shift+E` (exportar PDF).
- **Abrir archivo `.md`** existente desde disco (Tauri dialog + `readTextFile`).
- **Numeraci√≥n de l√≠neas** en el gutter del textarea.
- **Contadores en tiempo real**: palabras, caracteres, tiempo estimado de lectura (en el footer o barra de estado).
- **Indicador de l√≠nea/columna** actual del cursor.
- **Tab indentation**: Tab/Shift+Tab para indentar/desindentar l√≠neas.

#### [NEW] `src/hooks/useKeyboardShortcuts.ts`

- Hook centralizado para registrar y documentar todos los atajos.

#### [NEW] `src/components/Editor/StatusBar.tsx`

- Barra inferior con: conteo de palabras, l√≠nea:columna, tiempo de lectura estimado.

---

### Fase 3 ¬∑ Motor Pedag√≥gico Avanzado

> **Objetivo**: Transformar el an√°lisis de 4 reglas en un sistema extensible con categor√≠as y severidades, inspirado en Grammarly y Hemingway Editor.

#### [MODIFY] [markdownParser.ts](file:///Users/nestor/Documents/Desarrollo/Markdown%20editor/src/utils/markdownParser.ts)

- **Nuevas reglas de an√°lisis** (cada una con fix sugerido cuando aplique):
  - **Oraciones excesivamente largas** (>40 palabras): sugerir dividir.
  - **Voz pasiva** detectada por patrones: sugerir reformulaci√≥n activa.
  - **Repetici√≥n l√©xica**: detectar palabras sustantivas repetidas en p√°rrafos consecutivos.
  - **Sin conclusi√≥n**: documento >500 palabras sin un encabezado de cierre (Conclusi√≥n, Resumen, etc.).
  - **Listas hu√©rfanas**: lista sin contexto introductorio (p√°rrafo previo).
  - **Encabezado hu√©rfano**: encabezado seguido directamente de otro encabezado sin contenido intermedio.
- **Severidades**: `info` | `warning` | `error` con colores distintos en el overlay.
- **Categor√≠as**: `structure`, `style`, `clarity`, `syntax` para poder filtrarlas.

#### [MODIFY] [PedagogicalOverlay.tsx](file:///Users/nestor/Documents/Desarrollo/Markdown%20editor/src/components/Editor/PedagogicalOverlay.tsx)

- Indicadores de color por severidad (azul=info, √°mbar=warning, rojo=error).
- Animaci√≥n de pulso suave para errores nuevos vs. existentes.

#### [MODIFY] [TooltipContextual.tsx](file:///Users/nestor/Documents/Desarrollo/Markdown%20editor/src/components/Editor/TooltipContextual.tsx)

- Mostrar categor√≠a y severidad en la cabecera del tooltip.
- Bot√≥n "Ignorar" para descartar una advertencia de la sesi√≥n (sin fix, solo dismiss).

#### [NEW] `src/utils/pedagogicalRules.ts`

- Archivo independiente con todas las reglas como objetos configurables. Cada regla define: `id`, `category`, `severity`, `match(node, context)`, `message`, `fix?`.
- Permite a futuro que el usuario active/desactive reglas.

---

### Fase 4 ¬∑ Panel de Diagn√≥stico y Progreso

> **Objetivo**: Dar al escritor una vista consolidada de la calidad de su documento, m√°s all√° de los markers individuales.

#### [NEW] `src/components/Editor/DiagnosticsPanel.tsx`

- Panel lateral o modal con:
  - **Resumen visual**: donut chart o barra de progreso con % de advertencias resueltas.
  - **Lista de advertencias** agrupadas por categor√≠a, clickeables para saltar al punto del documento.
  - **Puntuaci√≥n de legibilidad** (√≠ndice Fern√°ndez-Huerta o similar para espa√±ol).
  - **Estad√≠sticas**: distribuci√≥n de encabezados, ratio de p√°rrafo/lista, densidad de √©nfasis.

#### [MODIFY] [Toolbar.tsx](file:///Users/nestor/Documents/Desarrollo/Markdown%20editor/src/components/Editor/Toolbar.tsx)

- Bot√≥n para abrir/cerrar el panel de diagn√≥stico.

---

### Fase 5 ¬∑ Accesibilidad y Pulido Visual

> **Objetivo**: Cumplir WCAG 2.1 AA y elevar la experiencia visual.

#### [MODIFY] [index.html](file:///Users/nestor/Documents/Desarrollo/Markdown%20editor/index.html)

- A√±adir `<html lang="es">`.

#### [MODIFY] Componentes varios

- A√±adir `aria-label`, `role`, y `aria-live` en:
  - Tooltips ‚Üí `role="tooltip"`, `aria-describedby`.
  - Indicadores del overlay ‚Üí `aria-label` descriptivo.
  - Botones de toolbar ‚Üí tooltip accesible con `title`.
  - Status bar ‚Üí `aria-live="polite"` para cambios din√°micos.
- **Navegaci√≥n por teclado** en tooltips: `Escape` para cerrar, focus trap.
- **Soporte de dark mode del sistema**: detectar `prefers-color-scheme` y aplicar autom√°ticamente.

#### [MODIFY] [index.css](file:///Users/nestor/Documents/Desarrollo/Markdown%20editor/src/index.css)

- A√±adir `@media (prefers-color-scheme: dark)` con fondo oscuro para `body` y `#root`, sincronizado con Tailwind `dark:`.
- Transici√≥n suave al cambiar tema.

---

### Fase 6 ¬∑ Testing Fundamental

> **Objetivo**: Establecer una cobertura m√≠nima de tests que proteja el motor pedag√≥gico y la l√≥gica de negocio.

#### [NEW] `vitest.config.ts`

- Configurar Vitest como runner de tests.

#### [NEW] `src/utils/__tests__/markdownParser.test.ts`

- Tests para cada regla pedag√≥gica: input Markdown ‚Üí warnings esperadas.
- Tests de edge cases: documento vac√≠o, solo espacios, markdown con 0 warnings.

#### [NEW] `src/hooks/__tests__/useFileOperations.test.ts`

- Tests de los hooks extra√≠dos (mock de Tauri API).

---

## Priorizaci√≥n Recomendada

```
Fase 1 (Refactor)   ‚îÄ‚îÄ‚ñ∫ Fase 2 (UX Escritura)  ‚îÄ‚îÄ‚ñ∫ Fase 3 (Motor Pedag√≥gico)
                                                           ‚îÇ
                                                           ‚ñº
                                        Fase 4 (Diagn√≥stico) ‚îÄ‚îÄ‚ñ∫ Fase 5 (A11y)
                                                                       ‚îÇ
                                                                       ‚ñº
                                                              Fase 6 (Testing)
```

> [!IMPORTANT]
> **La Fase 1 es prerrequisito**: sin el refactor, a√±adir funcionalidad al `Editor.tsx` monol√≠tico ser√° fr√°gil y dif√≠cil de mantener. Cada fase posterior asume que la anterior est√° terminada.

## Verificaci√≥n

### Automatizada

- Tras cada fase: `npx tsc --noEmit` debe pasar sin errores.
- Tras cada fase: `cd src-tauri && cargo check` debe compilar.
- Tras Fase 6: `npx vitest run` debe pasar todos los tests.

### Manual (por el usuario)

- Tras Fase 1: Validar que el editor funciona exactamente igual que antes (sin regresiones visuales ni de comportamiento).
- Tras Fase 2: Probar atajos de teclado, abrir un archivo `.md` existente, verificar contadores.
- Tras Fase 3: Escribir un texto de prueba con oraciones largas, voz pasiva y repeticiones; verificar que aparecen las nuevas advertencias.
- Tras Fase 5: Navegar toda la interfaz solo con teclado (Tab, Enter, Escape).
